<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>EedesiaBlox Hub</title>
<style>
body{margin:0;overflow:hidden;background:linear-gradient(45deg,red,green,orange,yellow);}
canvas{display:block;background:#b0c4de;}
button{position:absolute;padding:5px;cursor:pointer;}
#musicToggle{top:10px;left:10px;}
#hubBtn{top:50px;left:10px;}
#obbyBtn{top:90px;left:10px;}
#tycoonBtn{top:130px;left:10px;}
#jumpBtn{bottom:80px;left:50px;}
#leftBtn{bottom:20px;left:10px;}
#rightBtn{bottom:20px;left:100px;}
#chatBox{position:absolute;bottom:0;right:0;width:300px;height:200px;background:rgba(0,0,0,0.7);color:white;overflow-y:auto;font-family:sans-serif;padding:5px;}
#chatInput{position:absolute;bottom:0;right:0;width:240px;}
#chatSend{position:absolute;bottom:0;right:0;width:50px;}
</style>
</head>
<body>
<canvas id="game"></canvas>
<button id="musicToggle">Music On</button>
<button id="hubBtn">Hub</button>
<button id="obbyBtn">Obby</button>
<button id="tycoonBtn">Tycoon</button>
<button id="jumpBtn">Jump</button>
<button id="leftBtn">Left</button>
<button id="rightBtn">Right</button>
<div id="chatBox"></div>
<input type="text" id="chatInput" placeholder="Type..." />
<button id="chatSend">Send</button>
<script>
const canvas=document.getElementById('game');
const ctx=canvas.getContext('2d');
canvas.width=window.innerWidth; canvas.height=window.innerHeight;

// Multiplayer WebSocket
let ws=new WebSocket('ws://localhost:8080');
let playerId; let players={};

// Music
let music=new Audio('winds_of_fjords.mp3'); music.loop=true; music.play();
let musicPlaying=true;
document.getElementById('musicToggle').onclick=()=>{musicPlaying=!musicPlaying;musicPlaying?music.play():music.pause();};

// Controls
let keys={};
document.getElementById('jumpBtn').onclick=()=>{if(player.onGround)player.vy=jumpPower;}
document.getElementById('leftBtn').onclick=()=>{player.vx=-5;}
document.getElementById('rightBtn').onclick=()=>{player.vx=5;}
window.addEventListener('keydown',e=>keys[e.key]=true);
window.addEventListener('keyup',e=>keys[e.key]=false);

// Mode
let mode='hub';
document.getElementById('hubBtn').onclick=()=>{mode='hub';};
document.getElementById('obbyBtn').onclick=()=>{mode='obby';};
document.getElementById('tycoonBtn').onclick=()=>{mode='tycoon';};

// Player & physics
let gravity=0.7, jumpPower=-12;
let player={x:50,y:200,vx:0,vy:0,w:30,h:50,onGround:false};
let obstacles=[{x:200,y:400,w:100,h:20},{x:400,y:300,w:100,h:20}];

// Tycoon system
let money=0;
let tycoonBoxes=[{x:300,y:300,w:50,h:50,owned:false,level:0}];

// Chat
const chatBox=document.getElementById('chatBox');
const chatInput=document.getElementById('chatInput');
document.getElementById('chatSend').onclick=sendMessage;
chatInput.addEventListener('keydown',e=>{if(e.key==='Enter') sendMessage();});
function sendMessage(){
  const msg=chatInput.value.trim();
  if(msg==='')return;
  ws.send(JSON.stringify({type:'chat',msg}));
  chatInput.value='';
}

// WebSocket
ws.onmessage=(msg)=>{
  const data=JSON.parse(msg.data);
  if(data.type==='init'){playerId=data.id;players=data.players;}
  if(data.type==='players'){players=data.players;}
  if(data.type==='chat'){chatBox.innerHTML+='<div>'+data.player+': '+data.msg+'</div>'; chatBox.scrollTop=chatBox.scrollHeight;}
  if(data.type==='tycoon'){tycoonBoxes=data.tycoonBoxes;}
};

// Update function
function update(){
  // Hub does nothing special
  if(mode==='obby'){
    if(keys['ArrowLeft']) player.vx=-5; else if(keys['ArrowRight']) player.vx=5; else player.vx=0;
    if(keys['ArrowUp'] && player.onGround) player.vy=jumpPower;
    player.vy+=gravity;
    player.x+=player.vx; player.y+=player.vy;
    player.onGround=false;
    obstacles.forEach(o=>{
      if(player.x<o.x+o.w && player.x+player.w>o.x && player.y<o.y+o.h && player.y+player.h>o.y){
        player.y=o.y-player.h;
        player.vy=0;
        player.onGround=true;
      }
    });
    ws.send(JSON.stringify({type:'update',player:{x:player.x,y:player.y,w:player.w,h:player.h}}));
  } else if(mode==='tycoon'){
    money+=0.1;
    // Check for clicks to buy or upgrade
    canvas.onclick=e=>{
      const rect=canvas.getBoundingClientRect();
      const mx=e.clientX-rect.left;
      const my=e.clientY-rect.top;
      tycoonBoxes.forEach(b=>{
        if(mx>b.x && mx<b.x+b.w && my>b.y && my<b.y+b.h){
          if(!b.owned && money>=50){b.owned=true;b.level=1;money-=50;}
          else if(b.owned && money>=100){b.level++;money-=100;}
          ws.send(JSON.stringify({type:'tycoon',tycoonBoxes}));
        }
      });
    };
  }
}

// Draw function
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  if(mode==='hub'){
    ctx.fillStyle='black';
    ctx.font='50px Arial';
    ctx.fillText('Welcome to EedesiaBlox Hub',50,100);
  } else if(mode==='obby'){
    ctx.fillStyle='brown'; obstacles.forEach(o=>ctx.fillRect(o.x,o.y,o.w,o.h));
    ctx.fillStyle='blue'; for(let id in players){const p=players[id];ctx.fillRect(p.x,p.y,p.w||30,p.h||50);}
  } else if(mode==='tycoon'){
    ctx.fillStyle='green';
    ctx.font='40px Arial';
    ctx.fillText('Money: '+Math.floor(money),50,100);
    tycoonBoxes.forEach(b=>{
      ctx.fillStyle=b.owned?'orange':'gray';
      ctx.fillRect(b.x,b.y,b.w,b.h);
      if(b.owned){
        ctx.fillStyle='white';
        ctx.fillText('Lvl '+b.level,b.x,b.y-5);
      }
    });
  }
}

// Game loop
function loop(){update();draw();requestAnimationFrame(loop);}
loop();
</script>
</body>
</html>
