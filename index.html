<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Eedesia Blox Retro Platformer</title>
<style>
body{margin:0;font-family:monospace;background:linear-gradient(135deg,red,green,orange,yellow);color:black;display:flex;flex-direction:column;align-items:center;}
h1,h2{margin:5px;}
.buttons{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;margin-top:10px;}
.button{padding:8px 16px;cursor:pointer;font-weight:bold;text-align:center;border:2px solid black;user-select:none;}
.red{background:red;} .green{background:green;} .orange{background:orange;} .yellow{background:yellow;}
#obby{display:none;text-align:center;margin-top:10px;}
#gameCanvas{border:2px solid black;background:#87CEEB;display:block;margin:10px auto;}
#message{margin-top:5px;font-weight:bold;}
.mobileControls{display:flex;gap:5px;justify-content:center;margin-top:5px;}
.retroGUI{position:absolute;top:5px;left:5px;background:rgba(255,255,255,0.7);padding:5px;border:2px solid black;}
</style>
</head>
<body>
<h1>Eedesia Blox Hub</h1>
<div class="buttons" id="menu">
  <div class="button red" onclick="showObby()">Obby</div>
  <div class="button green" onclick="alert('Tycoon coming soon!')">Tycoon</div>
  <div class="button orange" onclick="alert('Simulator coming soon!')">Simulator</div>
  <div class="button yellow" onclick="window.open('https://www.eedesiablox.com','_blank')">Official</div>
  <div class="button" id="musicBtn" onclick="toggleMusic()">Music: Off</div>
</div>

<div id="obby">
  <h2>Eedesia Obby Platformer</h2>
  <canvas id="gameCanvas" width="500" height="300"></canvas>
  <div id="message"></div>
  <div class="mobileControls">
    <button onclick="moveLeft()">Left</button>
    <button onclick="jump()">Jump</button>
    <button onclick="moveRight()">Right</button>
  </div>
  <div style="margin-top:5px;">
    <button onclick="backToHub()">Back to Hub</button>
  </div>
</div>

<script>
// Mobile detection
if(/Mobi|Android/i.test(navigator.userAgent)){
  let note=document.createElement('p'); note.textContent="Mobile detected! Use on-screen buttons."; document.body.insertBefore(note, document.getElementById('menu'));
}

// Music toggle
let audio=new Audio('winds-of-fjords.mp3'); audio.loop=true; let musicOn=false;
function toggleMusic(){ if(musicOn){audio.pause();musicOn=false;document.getElementById('musicBtn').textContent="Music: Off";} else{audio.play();musicOn=true;document.getElementById('musicBtn').textContent="Music: On";}}

// Menu & Obby
function showObby(){document.getElementById('menu').style.display='none';document.getElementById('obby').style.display='block'; startGame();}
function backToHub(){document.getElementById('obby').style.display='none';document.getElementById('menu').style.display='flex';}

// Game setup
let canvas, ctx, player, gravity=0.6, keys={}, obstacles=[], finishX=450, level=0, levels, messageTimeout, checkpoints=[];

levels=[
  [{x:100,y:250,w:50,h:20},{x:200,y:220,w:60,h:20},{x:300,y:180,w:50,h:20},{x:400,y:240,w:50,h:20}],
  [{x:50,y:230,w:60,h:20},{x:150,y:200,w:40,h:20},{x:250,y:180,w:70,h:20},{x:380,y:220,w:50,h:20}],
  [{x:80,y:240,w:50,h:20},{x:180,y:210,w:50,h:20},{x:280,y:190,w:60,h:20},{x:400,y:230,w:40,h:20}]
];

function startGame(){
  canvas=document.getElementById('gameCanvas'); ctx=canvas.getContext('2d');
  player={x:50,y:200,w:20,h:20,vy:0};
  obstacles=JSON.parse(JSON.stringify(levels[level]));
  checkpoints=[{x:50,y:200}];
  document.getElementById('message').textContent="";
  requestAnimationFrame(updateGame);
}

// Controls
document.addEventListener('keydown',e=>{keys[e.key]=true;});
document.addEventListener('keyup',e=>{keys[e.key]=false;});
function moveLeft(){ keys['ArrowLeft']=true; setTimeout(()=>{keys['ArrowLeft']=false;},100);}
function moveRight(){ keys['ArrowRight']=true; setTimeout(()=>{keys['ArrowRight']=false;},100);}
function jump(){ if(onGround){ player.vy=-10; onGround=false; } }

let onGround=false;

function updateGame(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // horizontal movement always works, jump only triggers from ground
  if(keys['ArrowLeft']||keys['a']) player.x-=3;
  if(keys['ArrowRight']||keys['d']) player.x+=3;
  if((keys['ArrowUp']||keys['w']||keys[' ']) && onGround){ player.vy=-10; onGround=false; }

  // gravity
  player.vy+=gravity; player.y+=player.vy;

  // collisions
  onGround=false;
  for(let obs of obstacles){
    if(player.x+player.w>obs.x && player.x<obs.x+obs.w && player.y+player.h>obs.y && player.y<obs.y+obs.h){
      // from top
      if(player.vy>0 && player.y+player.h-obs.y<player.vy+1){player.y=obs.y-player.h;player.vy=0; onGround=true;}
      // from bottom
      else if(player.vy<0 && obs.y+obs.h-player.y<player.vy*-1){player.y=obs.y+obs.h;player.vy=0;}
      // from sides
      else if(player.x+player.w/2<obs.x+obs.w/2) player.x=obs.x-player.w;
      else player.x=obs.x+obs.w;
    }
  }

  if(player.y+player.h>270){player.y=270-player.h;player.vy=0;onGround=true;}

  // draw obstacles with shading
  for(let obs of obstacles){
    let dx=50-obs.x, dy=50-obs.y, shade=Math.max(0,1-Math.sqrt(dx*dx+dy*dy)/300);
    ctx.fillStyle=`rgba(${100+shade*155},${50+shade*100},0,1)`;
    ctx.fillRect(obs.x,obs.y,obs.w,obs.h);
  }

  // draw finish
  ctx.fillStyle='gold'; ctx.fillRect(finishX,250,10,20);

  // draw player
  ctx.fillStyle='red'; ctx.fillRect(player.x,player.y,player.w,player.h);
  ctx.fillStyle='rgba(0,0,0,0.2)'; ctx.fillRect(player.x+5,player.y+5,player.w,player.h);

  // checkpoint
  for(let obs of obstacles){
    if(player.y+player.h===obs.y && !checkpoints.find(c=>c.x===obs.x)){checkpoints.push({x:player.x,y:player.y});}
  }

  // finish
  if(player.x+player.w>=finishX){ level++; if(level>=levels.length){showMessage('You completed all levels!'); setTimeout(backToHub,1500); return;} showMessage('Level complete!'); setTimeout(startGame,1000); return;}

  // fall respawn
  if(player.y>300){ let cp=checkpoints[checkpoints.length-1]; player.x=cp.x; player.y=cp.y; player.vy=0; showMessage('Respawned at checkpoint!');}

  // retro GUI
  ctx.fillStyle='rgba(255,255,255,0.7)'; ctx.fillRect(5,5,120,40);
  ctx.strokeStyle='black'; ctx.strokeRect(5,5,120,40);
  ctx.fillStyle='black'; ctx.fillText(`Level: ${level+1}`,10,20); ctx.fillText(`Checkpoints: ${checkpoints.length}`,10,35);

  requestAnimationFrame(updateGame);
}

function showMessage(msg){
  const m=document.getElementById('message'); m.textContent=msg;
  clearTimeout(messageTimeout);
  messageTimeout=setTimeout(()=>{m.textContent='';},1000);
}
</script>
</body>
</html>
